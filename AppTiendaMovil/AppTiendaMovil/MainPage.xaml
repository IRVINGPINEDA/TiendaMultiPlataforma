<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AppTiendaMovil.MainPage"
             Title="Tienda movil">
    <ScrollView>
        <VerticalStackLayout Padding="18" Spacing="14">
            <Label Text="Tienda movil" FontSize="30" FontAttributes="Bold" />
            <Label x:Name="ApiStatusLabel" TextColor="#6c757d" FontSize="12" />

            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                <Entry x:Name="SearchEntry" Grid.Column="0" Placeholder="Buscar por nombre o marca" TextChanged="OnSearchTextChanged" />
                <Button Grid.Column="1" Text="Refrescar" Clicked="OnRefreshClicked" />
            </Grid>

            <Label Text="Productos" FontSize="22" FontAttributes="Bold" />
            <CollectionView x:Name="ProductsCollectionView" ItemsSource="{Binding Products}" SelectionMode="None" HeightRequest="340">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Stroke="#d9d9d9" StrokeShape="RoundRectangle 8" Padding="10" Margin="0,0,0,8">
                            <Grid ColumnDefinitions="72,*,Auto" ColumnSpacing="10">
                                <Image Grid.Column="0" Source="{Binding ImageSource}" HeightRequest="64" WidthRequest="64" Aspect="AspectFill" />
                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                    <Label Text="{Binding Nombre}" FontAttributes="Bold" />
                                    <Label Text="{Binding Marca}" FontSize="13" TextColor="#6c757d" />
                                    <Label Text="{Binding PrecioText}" FontSize="15" FontAttributes="Bold" />
                                    <Label Text="{Binding StockText}" FontSize="12" TextColor="#495057" />
                                </VerticalStackLayout>
                                <Button Grid.Column="2" Text="+ Carrito" Clicked="OnAddToCartClicked" VerticalOptions="Center" />
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label Text="Carrito" FontSize="22" FontAttributes="Bold" />
            <CollectionView ItemsSource="{Binding CartItems}" SelectionMode="None" HeightRequest="220">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Stroke="#ececec" StrokeShape="RoundRectangle 8" Padding="10" Margin="0,0,0,8">
                            <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto" RowSpacing="4">
                                <Label Text="{Binding ProductName}" FontAttributes="Bold" />
                                <Label Grid.Row="1" Text="{Binding TotalText}" />
                                <Label Grid.Row="2" Text="{Binding QuantityText}" TextColor="#6c757d" FontSize="12" />
                                <HorizontalStackLayout Grid.Column="1" Grid.RowSpan="3" Spacing="6" VerticalOptions="Center">
                                    <Button Text="-" Clicked="OnDecreaseCartItemClicked" />
                                    <Button Text="+" Clicked="OnIncreaseCartItemClicked" />
                                    <Button Text="Quitar" Clicked="OnRemoveCartItemClicked" />
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Label x:Name="CartSummaryLabel" FontAttributes="Bold" />

            <Label Text="Datos de compra" FontSize="20" FontAttributes="Bold" />
            <Entry x:Name="ClienteNombreEntry" Placeholder="Nombre completo" />
            <Entry x:Name="ClienteTelefonoEntry" Placeholder="Telefono (opcional)" Keyboard="Telephone" />
            <Entry x:Name="DireccionEntregaEntry" Placeholder="Direccion de entrega" />
            <Editor x:Name="NotasEditor" Placeholder="Notas (opcional)" AutoSize="TextChanges" />

            <Button Text="Comprar ahora" BackgroundColor="#198754" TextColor="White" Clicked="OnCheckoutClicked" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
