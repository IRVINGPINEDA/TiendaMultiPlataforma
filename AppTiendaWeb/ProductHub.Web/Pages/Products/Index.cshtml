@page
@model ProductHub.Web.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Productos";
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Productos</h1>
    <a class="btn btn-success" asp-page="Create">Nuevo producto</a>
</div>

<form method="get" class="row g-2 mb-3">
    <div class="col-md-6">
        <input class="form-control" asp-for="Search" placeholder="Buscar por nombre o marca" />
    </div>
    <div class="col-md-3 form-check d-flex align-items-center">
        <input class="form-check-input me-2" asp-for="IncludeInactive" />
        <label class="form-check-label" asp-for="IncludeInactive">Incluir inactivos</label>
    </div>
    <div class="col-md-3 d-grid">
        <button type="submit" class="btn btn-outline-primary">Buscar</button>
    </div>
</form>

@if (!Model.Products.Any())
{
    <div class="alert alert-info">No se encontraron productos.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>Imagen</th>
                    <th>Nombre</th>
                    <th>Marca</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Estado</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model.Products)
            {
                <tr>
                    <td>
                        @if (!string.IsNullOrWhiteSpace(item.ImageUrl))
                        {
                            <img src="@item.ImageUrl" alt="@item.Nombre" style="width:64px;height:64px;object-fit:cover;" class="rounded" />
                        }
                        else
                        {
                            <span class="text-muted">Sin imagen</span>
                        }
                    </td>
                    <td>@item.Nombre</td>
                    <td>@item.Marca</td>
                    <td>@item.Precio.ToString("C")</td>
                    <td>@item.CantidadStock</td>
                    <td>
                        @if (item.IsActive)
                        {
                            <span class="badge bg-success">Activo</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Inactivo</span>
                        }
                    </td>
                    <td class="text-end">
                        <a asp-page="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary">Editar</a>
                        <a asp-page="Image" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info">Imagen</a>
                        @if (item.IsActive)
                        {
                            <form method="post" asp-page-handler="Delete" asp-route-id="@item.Id" class="d-inline">
                                <input type="hidden" name="search" value="@Model.Search" />
                                <input type="hidden" name="includeInactive" value="@Model.IncludeInactive" />
                                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('¿Eliminar este producto?');">Eliminar</button>
                            </form>
                        }
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}
